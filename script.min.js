class DataTable{constructor({id:d,ajax:a=null,perPage:b=20,searchBox:c=!1,colVisibilitySelector:e=null,colSelectFilter:f=null,tooManyUseInput:g=!1,rowCreated:h=null,colFormat:i=null,colCreated:j=null,initComplete:k=null,error:l=null}){if(!d)return console.error("No table id given.");if(this.table=document.getElementById(d),!this.table)return console.error("Invalid table id given.");if(this.table.setAttribute("data-table",""),this.columns_count=this.table.querySelectorAll("thead th")?.length,!this.columns_count)return console.error("No column headers found on table.");if(!b)return console.error("Invalid number of items per page given.");if("number"==typeof b?(this.perPage=b||20,this.perPageSelector=!0,this.perPageOptions=[5,10,20,50,100],this.perPageSelectorContainerSelector=null):(this.perPage=b.default||20,this.perPageSelector=b.selector||!0,this.perPageOptions=b.options||[5,10,20,50,100],this.perPageSelectorContainerSelector=b.container||null),this.tooManyUseInput=g,this.colVisibilitySelector=e,this.columnSelected=new Array,a){if("string"==typeof a)this.ajaxUrl=a;else{if(this.ajaxUrl=a.url||null,a.method&&"POST"!=a.method&&"GET"!=a.method)return console.error("Invalid ajax method given.");this.ajaxMethod=a.method||"POST",this.dataSrc=a.dataSrc||""}}"boolean"==typeof c?(this.searchBox=c,this.searchBoxContainerSelector=null,this.searchBoxTimeout=400):(this.searchBox=c.enable||!0,this.searchBoxContainerSelector=c.container||null,this.searchBoxTimeout=c.timeout||400),this.colSelectFilter=f||[],this.searchTimeout=null,this.searchText="",this.initComplete=k,this.error=l,this.rowCreated=h,this.colFormat=i,this.colCreated=j,this.page=0,this.orderby=0,this.order_direction="ASC",this.colUniqueFiltersSelected=new Array,this.loadTable()}loadTable=async()=>{this.addHeaderSortListeners(),this.addcolVisibilitySelector(),this.ajaxUrl&&await this.getDataFromFile(!0),this.addSearchBox(),this.addPerPageSelector(),this.addColumnSelectFilters()};getDataFromFile=async(d=!1)=>{try{let c;if(this.ajaxMethod&&"POST"!=this.ajaxMethod)c=await fetch(this.ajaxUrl+"?"+new URLSearchParams({page:this.page,limit:this.perPage,orderby:this.orderby,order_direction:this.order_direction,searchText:this.searchText,col_select_filter:d?this.colSelectFilter:[]}),{method:"GET"});else{let a=new FormData;a.append("page",this.page),a.append("limit",this.perPage),a.append("orderby",this.orderby),a.append("order_direction",this.order_direction),a.append("search_text",this.searchText),d&&this.colSelectFilter&&this.colSelectFilter.forEach(b=>a.append("col_select_filter[]",b)),Object.entries(this.colUniqueFiltersSelected).forEach(([b,c])=>{a.append("col_unique_filters_selected_keys[]",b),a.append("col_unique_filters_selected_values[]",c)}),c=await fetch(this.ajaxUrl,{method:"POST",body:a})}if(!c)throw"No data recieved from request.";let e=await c.json(),b=this.dataSrc&&this.dataSrc.length>0?e[0][this.dataSrc]:e[0];this.totalRows=b.total_rows,this.totalRows?(this.replaceRows(b.data),this.addPagination(),b.unique&&(this.uniqueSelectsData=new Array,Object.entries(b.unique).forEach(([a,b])=>{this.uniqueSelectsData[a]=new Array,b.split("|").forEach(b=>this.uniqueSelectsData[a].push(b))}))):this.noDataFound(),this.initComplete&&"function"==typeof this.initComplete&&this.initComplete({data:b.data,total_rows:b.total_rows,table:this.table})}catch(f){this.error&&"function"==typeof this.error?this.error(f):console.error(f)}};getDefaultFiltersContainer=()=>{let a=this.table.closest(".data-table-container").querySelector(".data-table-filters");return a||((a=document.createElement("div")).classList.add("data-table-filters"),a.setAttribute("for-data-table",this.table.getAttribute("id")),this.table.before(a)),a};getDefaultSelectorsContainer=()=>{let a=this.table.closest(".data-table-container").querySelector(".data-table-selectors");return a||((a=document.createElement("div")).classList.add("data-table-selectors"),a.setAttribute("for-data-table",this.table.getAttribute("id")),this.table.before(a)),a};getDefaultUniqueSelectorsContainer=()=>{let a=this.table.closest(".data-table-container").querySelector(".data-table-unique-selectors");return a||((a=document.createElement("div")).classList.add("data-table-unique-selectors"),a.setAttribute("for-data-table",this.table.getAttribute("id")),this.table.before(a)),a};addcolVisibilitySelector=()=>{if(!this.colVisibilitySelector||!this.colVisibilitySelector.enable)return;this.colVisibilitySelector.container&&(this.colVisibilitySelector.container=document.querySelector(this.colVisibilitySelector.container)),this.colVisibilitySelector.container||(this.colVisibilitySelector.container=this.getDefaultSelectorsContainer());let a=document.createElement("div");a.classList.add("columns-selector");let d=document.createElement("label");d.innerText=this.colVisibilitySelector.name||"Column Selector",d.addEventListener("click",a=>a.currentTarget.parentElement.classList.toggle("open"));let e=document.createElement("ul"),f=this.table.querySelectorAll("thead th"),b;for(let c=0;c<this.columns_count;c++)this.columnSelected.push(c),(b=document.createElement("li")).classList.add("selected"),b.innerText=f[c].innerText,b.addEventListener("click",this.toggleSelectedColumn),e.append(b);a.append(d),a.append(e),this.colVisibilitySelector.container.prepend(a)};toggleSelectedColumn=a=>{let b=Array.prototype.indexOf.call(a.currentTarget.parentNode.children,a.currentTarget),c=this.columnSelected.findIndex(a=>a==b);a.currentTarget.classList.contains("selected")?(a.currentTarget.classList.remove("selected"),c> -1&&(this.columnSelected.splice(c,1),this.showColumn(b))):(a.currentTarget.classList.add("selected"),-1==c&&(this.columnSelected.push(b),this.hideColumn(b)))};showColumn=d=>{let a=this.table.querySelectorAll(`thead tr th:nth-child(${d+1})`);for(let b=0;b<a.length;b++)a[b].classList.contains("hidden")||a[b].classList.add("hidden");a=this.table.querySelectorAll(`tbody tr td:nth-child(${d+1})`);for(let c=0;c<a.length;c++)a[c].classList.contains("hidden")||a[c].classList.add("hidden")};hideColumn=d=>{let a=this.table.querySelectorAll(`thead tr th:nth-child(${d+1})`);for(let b=0;b<a.length;b++)a[b].classList.contains("hidden")&&a[b].classList.remove("hidden");a=this.table.querySelectorAll(`tbody tr td:nth-child(${d+1})`);for(let c=0;c<a.length;c++)a[c].classList.contains("hidden")&&a[c].classList.remove("hidden")};addColumnSelectFilters=()=>{if(this.colSelectFilter){this.uniqueSelectorsContainer=this.getDefaultUniqueSelectorsContainer();let a,b,c;for(let d=0;d<this.colSelectFilter.length;d++)a=this.colSelectFilter[d],this.uniqueSelectsData[a]&&this.uniqueSelectsData[a].length&&((b=document.createElement("select")).setAttribute("data-filter-column",a),(c=document.createElement("option")).innerHTML="Filter "+a,c.value="",b.append(c),this.uniqueSelectsData[a].forEach(a=>{(c=document.createElement("option")).innerHTML=a,c.value=a,b.append(c)}),b.addEventListener("change",this.uniqueSelectChangeEvent),this.uniqueSelectorsContainer.append(b))}};addPerPageSelector=()=>{if(!this.perPageSelector||!this.perPageOptions?.length)return;this.perPageSelectorContainerSelector&&(this.perPageSelectorContainer=document.querySelector(this.perPageSelectorContainerSelector)),this.perPageSelectorContainer||(this.perPageSelectorContainer=this.getDefaultFiltersContainer());let a=document.createElement("div");a.classList.add("entries-filter");let b=document.createElement("span");b.innerHTML="Per Page:";let c=document.createElement("select");c.addEventListener("change",this.onPerPageChange);let d;this.perPageOptions.forEach(a=>{(d=document.createElement("option")).value=a,d.innerHTML=a,a==this.perPage&&(d.selected=!0),c.append(d)}),a.append(b),a.append(c),this.perPageSelectorContainer.prepend(a)};addSearchBox=()=>{if(!this.searchBox)return;this.searchBoxContainerSelector&&(this.searchBoxContainer=document.querySelector(this.searchBoxContainerSelector)),this.searchBoxContainer||(this.searchBoxContainer=this.getDefaultFiltersContainer());let a=document.createElement("div");a.classList.add("search-filter");let c=document.createElement("span");c.innerHTML="Search:";let b=document.createElement("input");b.type="text",b.addEventListener("keyup",this.onSearchInput),a.append(c),a.append(b),this.searchBoxContainer.prepend(a)};onPerPageChange=a=>{this.perPage=a.currentTarget.value,this.getDataFromFile()};onSearchInput=a=>{this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(this.searchFilterTable,this.searchBoxTimeout,a.currentTarget.value)};searchFilterTable=a=>{this.searchText=a,this.getDataFromFile()};noDataFound=()=>{if(this.page>0){this.page=0,this.getDataFromFile();return}let b=this.table.querySelector("tbody")||this.generateTBody();b.textContent="";let c=document.createElement("tr"),a=document.createElement("td");a.setAttribute("colspan",this.columns_count),a.innerHTML="No data found.",c.append(a),b.append(c)};generateTBody=()=>{let a=document.createElement("tbody");return this.table.append(a),a};generateTFoot=()=>{let a=document.createElement("tfoot");return this.table.append(a),a};replaceRows=b=>{this.rows=new Array;let f=this.table.querySelector("tbody")||this.generateTBody();f.textContent="";let c,e,d,a,h=b[0].length,g;for(a=0;a<this.perPage;a++)if((c=document.createElement("tr")).classList.add(a%2==0?"even":"odd"),!(a>=b.length)){for(d=0;d<h;d++)e=document.createElement("td"),g=this.colFormat&&"function"==typeof this.colFormat?this.colFormat(c,d,b[a]):null,e.innerHTML=g||b[a][d],this.colVisibilitySelector?.enable&& -1==this.columnSelected.findIndex(a=>a==d)&&e.classList.add("hidden"),c.append(e),this.colCreated&&"function"==typeof this.colCreated&&this.colCreated(c,e,d,b[a]);f.append(c),this.rowCreated&&"function"==typeof this.rowCreated&&this.rowCreated(c,b[a])}};addPagination=()=>{let c=this.table.querySelector("tfoot")||this.generateTFoot(),n=0;n=c.querySelectorAll("tr td .pages-container")?.length||0,this.totalPages=Math.floor(this.totalRows/this.perPage)+(this.totalRows%this.perPage>0?1:0);let a,b,f,e,g;if(n){this.page>0?(this.prevBtn.classList.contains("disabled")&&this.prevBtn.classList.remove("disabled"),this.page+1>=this.totalPages&&!this.nextBtn.classList.contains("disabled")?this.nextBtn.classList.add("disabled"):this.page+1<this.totalPages&&this.nextBtn.classList.contains("disabled")&&this.nextBtn.classList.remove("disabled")):(this.prevBtn.classList.contains("disabled")||this.prevBtn.classList.add("disabled"),this.totalPages>1&&this.nextBtn.classList.contains("disabled")&&this.nextBtn.classList.remove("disabled")),c.querySelectorAll("tr td .pages-container [data-page]").forEach(a=>a.remove()),c.querySelectorAll("tr td .pages-container .btn_dots").forEach(a=>a.remove()),c.querySelector("tr td .pages-container input")?.remove();let h=c.querySelector("[data-next]"),o=this.totalPages>20;if(o){if(this.tooManyUseInput)for(a=0;a<this.totalPages;a++)6==a&&((g=document.createElement("input")).type="text",g.addEventListener("change",this.pageNumberTypeEvent),h.before(g),a=this.totalPages-6),(b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),h.before(b);else{let i=0;for(a=0;a<this.totalPages;a++)i=this.page-a,a<3||a>=this.totalPages-3||i<2&&i> -2?((b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),h.before(b)):((b=document.createElement("div")).innerText="...",b.classList.add("btn_dots"),h.before(b),a=a>this.page-2?this.totalPages-4:this.page-2)}}else for(a=0;a<this.totalPages;a++)(b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),h.before(b);c.querySelector(".active")?.classList.remove("active"),c.querySelector(`[data-page="${this.page}"]`)?.classList.add("active");let j=this.page*this.perPage+1;c.querySelector(".page-info").innerText=`Showing ${j} to ${j+this.perPage>this.totalRows?this.totalRows:j+this.perPage} of ${this.totalRows} entries`}else{f=document.createElement("tr"),e=document.createElement("td"),e.setAttribute("colspan",this.columns_count);let k=document.createElement("div"),l=this.page*this.perPage+1;k.innerText=`Showing ${l} to ${l+this.perPage>this.totalRows?this.totalRows:l+this.perPage} of ${this.totalRows} entries`,k.classList.add("page-info"),e.append(k),f.append(e),c.append(f),f=document.createElement("tr"),e=document.createElement("td"),e.setAttribute("colspan",this.columns_count);let d=document.createElement("div");d.classList.add("pages-container"),this.prevBtn=document.createElement("div"),this.prevBtn.innerHTML="Previous",this.prevBtn.setAttribute("data-prev",""),this.prevBtn.classList.add("page_btn_prev"),this.prevBtn.classList.add("disabled"),this.prevBtn.addEventListener("click",this.prevClickEvent),d.append(this.prevBtn);let p=this.totalPages>20;if(p){if(this.tooManyUseInput)for(a=0;a<this.totalPages;a++)6==a&&((g=document.createElement("input")).type="text",g.addEventListener("change",this.pageNumberTypeEvent),d.append(g),a=this.totalPages-6),(b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),d.append(b);else{let m=0;for(a=0;a<this.totalPages;a++)m=this.page-a,a<3||a>=this.totalPages-3||m<2&&m> -2?((b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),d.append(b)):((b=document.createElement("div")).innerText="...",b.classList.add("btn_dots"),d.append(b),a=a>this.page-2?this.totalPages-4:this.page-2)}}else for(a=0;a<this.totalPages;a++)(b=document.createElement("div")).innerHTML=a+1,b.setAttribute("data-page",a),b.classList.add("page_btn"),b.addEventListener("click",this.pageNumberClickEvent),d.append(b);d.querySelector('[data-page="0"]')?.classList.add("active"),this.nextBtn=document.createElement("div"),this.nextBtn.innerHTML="Next",this.nextBtn.setAttribute("data-next",""),this.nextBtn.classList.add("page_btn_next"),this.nextBtn.addEventListener("click",this.nextClickEvent),d.append(this.nextBtn),e.append(d),f.append(e),c.append(f)}};pageNumberClickEvent=b=>{let a=parseInt(b.currentTarget.getAttribute("data-page"));this.page!=a&&(this.page=a,this.getDataFromFile())};pageNumberTypeEvent=b=>{let a=parseInt(b.currentTarget.value);this.page!=a&&a<this.totalPages&&(this.page=a-1,this.getDataFromFile())};prevClickEvent=a=>{this.page>0&&(this.page--,this.getDataFromFile())};nextClickEvent=a=>{this.totalPages>this.page+1&&(this.page++,this.getDataFromFile())};addHeaderSortListeners=()=>{let b=this.table.querySelectorAll("thead th");for(let a=0;a<b.length;a++)b[a].addEventListener("click",this.sortHeader)};sortHeader=a=>{let b=Array.prototype.indexOf.call(a.currentTarget.parentNode.children,a.currentTarget);this.orderby==b?this.order_direction="ASC"==this.order_direction?"DESC":"ASC":(this.orderby=b,this.order_direction="ASC"),this.getDataFromFile()};uniqueSelectChangeEvent=a=>{a.currentTarget.value.length?this.colUniqueFiltersSelected[a.currentTarget.getAttribute("data-filter-column")]=a.currentTarget.value:delete this.colUniqueFiltersSelected[a.currentTarget.getAttribute("data-filter-column")],this.getDataFromFile()}}